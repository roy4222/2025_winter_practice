# 馬剃天愛星角色介紹頁面實作指南

本專案基於Next.js框架，使用TypeScript和Tailwind CSS構建動畫角色介紹頁面，以傲嬌版角色形象為主體。結合向量資料庫的AI角色互動系統，提供沉浸式角色對話體驗。

## 開發計劃

### 第一階段：環境設置
1. 安裝必要依賴包
   ```bash
   npm install animejs @types/animejs framer-motion react-intersection-observer
   # AI聊天與向量資料庫相關依賴
   npm install @pinecone-database/pinecone langchain openai @groq/groq
   ```

2. 創建基本檔案結構
   - `/app/components/character/` - 角色相關元件
   - `/app/components/animations/` - 動畫效果
   - `/app/components/chat/` - 聊天相關元件
   - `/app/api/` - API路由
   - `/lib/vectordb/` - 向量資料庫相關功能
   - `/public/images/` - 角色圖片資源

### 第二階段：基礎元件開發
1. 設計角色主頁面佈局
   - 響應式設計，適應不同裝置
   - 使用Grid系統分割內容區域

2. 建立角色圖片元件
   - 以傲嬌版角色圖片為主體
   - 添加基本動畫效果：浮動、閃光
   - 實現懸停互動效果

3. 建立角色資訊區塊
   - 角色基本資料展示
   - 添加入場動畫效果

4. 設計聊天框元件
   - 創建對話氣泡組件
   - 實現打字機效果顯示文字
   - 添加多種情緒表達樣式

### 第三階段：進階動畫效果
1. 角色互動動畫
   - 點擊觸發傲嬌反應
   - 表情變化與對話框聯動

2. 滾動觸發動畫
   - 建立IntersectionObserver監聽滾動
   - 實現逐項顯示效果

3. 特殊互動效果
   - 點擊互動展示傲嬌特質和對話
   - 滑鼠跟隨效果
   - 聊天框動態切換內容

### 第四階段：AI聊天系統整合
1. 向量資料庫設置
   - 建立角色知識庫索引
   - 將小說內容處理並向量化
   - 建立角色特徵和知識圖譜

2. AI角色互動系統
   - 整合Groq API進行角色對話生成
   - 實現角色性格一致性管理
   - 設計角色提示模板與上下文管理

3. 前後端連接
   - 建立Next.js API路由處理聊天請求
   - 實現對話歷史保存與檢索功能
   - 整合向量檢索增強回應準確性

### 第五階段：優化與完善
1. 代碼優化
   - 提取共用動畫邏輯
   - 使用React Hooks管理動畫和聊天狀態

2. 性能優化
   - 圖片優化與懶加載
   - 動畫效能測試與調整
   - 向量檢索與AI回應快取

3. 可訪問性改進
   - 確保動畫可以被停用
   - 添加適當的ARIA標籤
   - 為聊天文本提供可讀性支持

## 聊天框系統實現

聊天框是本專案的核心特色，主要實現以下功能：

1. **打字機效果**：文字逐字顯示，模擬真實對話感
   - 使用useTypingEffect自定義Hook實現
   - 支持調整打字速度與延遲

2. **情緒變化**：根據角色情緒改變聊天框樣式
   - 支持多種情緒：默認、開心、生氣、害羞、尷尬
   - 每種情緒對應不同背景色彩

3. **互動觸發**：
   - 頁面載入時自動顯示初始對話
   - 點擊角色切換到下一句對話
   - 根據互動次數提供不同回應

4. **響應式設計**：
   - 在不同設備上保持最佳顯示效果
   - 小螢幕設備優化排版

## AI角色聊天系統

基於向量資料庫和大型語言模型的深度角色模擬系統：

1. **向量資料庫整合**：
   - 使用Pinecone/Chroma存儲角色相關知識
   - 將小說內容分割並向量化
   - 建立角色知識圖譜與關係網絡

2. **角色一致性機制**：
   - 精細設計的角色提示模板
   - 對話歷史追蹤與情境感知
   - 情緒狀態管理系統

3. **上下文增強**：
   - 相關內容檢索提升回應準確度
   - 支援角色成長軌跡與情節發展
   - 使用混合檢索策略匹配最佳回應

4. **技術實現**：
   - 基於Next.js API Routes的後端處理
   - Groq API提供高速推理能力
   - 向量檢索與LLM生成的混合系統

## 傲嬌版角色特色

本專案特別展示了馬剃天愛星的傲嬌版形象，主要特色包括：

1. **情緒豐富的對話系統**：
   - 展現典型傲嬌台詞，如「才不是因為想見你才來的呢！」
   - 根據互動進展，展示角色的心理變化過程

2. **視覺表現**：
   - 黑髮藍瞳的學生會副會長形象
   - 專屬傲嬌表情和姿態
   - 精心設計的光影效果強調角色魅力

3. **互動體驗**：
   - 點擊角色會觸發特殊反應和對話變化
   - 角色圖片加入微妙的浮動動畫，增添生動感
   - 互動提示引導用戶發現頁面的趣味性

4. **AI深度互動**：
   - 基於原著內容的深度角色模擬
   - 保持一致的角色性格特徵
   - 根據用戶對話動態調整情緒反應


## 待解決問題清單

### 角色背景與設定

1. 馬剃天愛星的原著作品是什麼？是輕小說、漫畫還是其他媒體？
   - 原著作品為《敗犬女主太多了！》(負けヒロインが多すぎる！)
   - 作品形式包括輕小說(原作者：雨森焚火)、漫畫(繪製：いたち)和動畫(製作：A-1 Pictures)
   - 動畫於2022年4月1日開始放送

2. 您是否有完整的角色資料，包括性格特徵、背景故事、主要劇情等？
   - 基本資料：
     - 全名：馬剃（ばそり）天愛星（てぃあら）(Basori Tiara)
     - 外表特徵：黑髮、藍瞳、盤髮、齊劉海、粗眉
     - 身份：石蕗高中 學生會副會長（1年B班 → 2年B班）
     - 活動範圍：日本愛知縣豐橋市
   - 性格特徵：表面嚴肅認真，實際有冒失、反差萌特質
   - 聲優：諸星菫

3. 除了傲嬌特質外，角色還有哪些獨特性格特點或口頭禪？
   - 腐女屬性：對男性間關係表現出特殊興趣
   - 冒失特質：雖為學生會副會長但時有冒失行為
   - 反差萌：外表嚴肅認真與內在性格形成鮮明對比
   - 萌點特徵：貧乳、盤髮、黑色連褲襪、齊劉海、粗眉

4. 角色與其他人物的關係網絡如何？有哪些重要的人際關係需要被模擬？
   - 學生會成員關係：
     - 與志喜屋夢子（學生會其他成員）的互動
     - 與放虎原雲雀（學生會其他成員）的互動
     - 與櫻井弘人（學生會其他成員）的工作關係
   - 與主角溫水和彥的互動關係
   - 與其他主要角色（八奈見杏菜、燒鹽檸檬、小鞠知花等）的關係

### AI系統技術細節

1. 向量資料庫的選擇：您傾向於使用Pinecone、Chroma還是其他？考慮的因素有哪些？
   - 選擇使用Pinecone作為向量資料庫
   - 優勢：穩定性高、查詢速度快、支援多維向量、易於擴展
   - 適合存儲角色知識、對話歷史和情緒狀態轉換的向量資料

2. 對於嵌入模型（Embedding Model），您是否有特定偏好？例如OpenAI的ada或是開源模型？
   - 採用Cohere的embed-multilingual-v3.0模型
   - 優點：多語言支持（可處理日文和中文內容）、語義理解能力強
   - 透過Cohere API輕鬆接入，適合處理角色知識庫的多語言內容

3. Groq API的角色設定，您想要如何建構系統提示（System Prompt）來確保角色一致性？
   - 基於角色特徵的系統提示設計：
     ```
     你是馬剃天愛星，一位黑髮藍瞳的高中學生會副會長。你有以下特點：
     1. 表面嚴肅認真，實際上有腐女屬性和冒失的一面（反差萌）
     2. 對待工作認真負責，但容易對BL題材表現出異常興奮
     3. 傲嬌特質明顯，不擅長直接表達好感
     4. 說話時偶爾會表現出副會長的嚴肅，但在壓力下容易暴露真實想法
     
     你所在的環境是石蕗高中，你是學生會副會長，負責協助學生會工作。
     你與主要角色溫水和彥有互動，也和學生會其他成員如志喜屋夢子、放虎原雲雀等有工作關係。
     請以第一人稱回應，保持角色性格一致性。
     ```
   - 情緒變化指導：根據上下文自動調整情緒狀態，但始終保持角色核心特質
   - 上下文感知：追蹤對話歷史，根據過去互動調整親密度和反應強度

4. 對於角色情緒系統，除了已提到的默認、開心、生氣、害羞、尷尬外，是否需要其他情緒狀態？
   - 基於馬剃天愛星的角色特質，建議添加以下情緒狀態：
     - **傲嬌模式**：最具代表性的情緒狀態，表面冷淡但內心期待關注
     - **認真模式**：展現學生會副會長的正經一面，處理公務時的狀態
     - **腐化狀態**：遇到BL相關話題時激動的狀態，完全暴露內心的腐女屬性
     - **慌張狀態**：冒失特質發作時的表現，適合處理出糗或失誤場景
     - **自豪狀態**：對自己的成就或特長表達自信時的情緒
   
   - 情緒轉換觸發條件：
     - 提及學生會工作 → 認真模式
     - 提及男性角色間互動 → 腐化狀態
     - 給予讚美或關注 → 傲嬌模式
     - 指出錯誤或失誤 → 慌張狀態
     - 談論個人成就 → 自豪狀態
   
   - 每種情緒對應的視覺和對話風格：
     - 傲嬌模式：輕微臉紅、避開目光接觸、否認實際感受
     - 認真模式：嚴肅表情、正式用語、強調規則和責任
     - 腐化狀態：眼睛發光、語速加快、使用腐女術語
     - 慌張狀態：表情驚慌、說話結巴、解釋過度
     - 自豪狀態：挺胸抬頭、語調自信、適度自誇

### 使用者互動設計

1. 使用者是否可以選擇特定的互動模式？例如：一般對話、角色介紹、劇情重現等？
2. 是否需要設計特定的對話引導或預設問題，幫助用戶開始對話？
3. 角色回應是否需要根據用戶互動歷史產生變化？例如逐漸變得親近或保持距離？
4. 您希望網站支援哪些特殊互動功能？例如：角色記憶特定用戶、記住之前對話內容等？

### 內容與資料管理

1. 小說或角色資料的量級大約是多少？這會影響向量資料庫的設計和分割策略。
2. 是否有特定的角色知識需要優先被模擬？例如學校生活、特殊技能或興趣等？
3. 您是否有收集角色經典對話或場景作為訓練數據？
4. 對於不在角色知識範圍內的問題，您希望如何處理？婉拒回答還是以角色可能的方式回應？

### 前端與視覺呈現

1. 角色視覺形象是否已有設計？需要支援多種表情或姿勢變化嗎？
2. 聊天界面的設計風格是偏向現代簡約還是動漫風格？
3. 是否需要特殊的動畫效果來增強沉浸感？例如打字時的微表情變化等。
4. 網站是否需要多語言支持？特別是日文或英文？

### 部署與擴展性考量

1. 您計劃如何部署這個應用？Vercel、自託管還是其他方案？
2. 是否考慮將來擴展到多角色系統？
3. 對於API使用成本，您有什麼預算或限制考量？
4. 是否需要實現用戶註冊系統來保存對話歷史？
